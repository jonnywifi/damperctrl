substitutions:
  name: damperctrl
  friendly_name: Damper Control
  location: "Unknown"
  maxbrightness: "0.0"
  version: "0.26"

esphome:
  platform: ESP8266
  board: d1_mini
  name: "${name}"
  # Automatically add the MAC address to the name so you can use a single firmware for all devices
  name_add_mac_suffix: true

  # This allows for project identification, configuration, and updates.
  project:
    name: esphome.damperctrl
    version: "${version}"

  # Home the damper at startup
  on_boot:
    then:
      - delay: 5s
      - stepper.set_speed:
          id: my_stepper
          speed: 200
      - stepper.report_position:
          id: my_stepper
          position: 0
      - stepper.set_target:
          id: my_stepper
          target: -800
      - delay: 10s
      - stepper.report_position:
          id: my_stepper
          position: 0
      - stepper.set_speed:
          id: my_stepper
          speed: 100
      - stepper.set_target:
          id: my_stepper
          target: 500

# This should point to the public location of this YAML file.
dashboard_import:
  package_import_url: github://jonnywifi/damperctrl/damperctrl.yaml

# Enable logging
logger:

# Enable OTA upgrade
ota:

# WiFi configuration
wifi:
  ap:
    ssid: ${name}
    password: "12345678"

# Enable captive portal
captive_portal:

# Enable Home Assistant API
api:
  services:
    - service: "vent_open_pcnt"
      variables:
        target: int
        speed: int
      then:
        - stepper.set_speed:
            id: my_stepper
            speed: !lambda 'return speed;'
        - stepper.set_target:
            id: my_stepper
            target: !lambda 'return target * 5;'

# Stepper motor configuration
stepper:
  - platform: a4988
    id: my_stepper
    step_pin: GPIO1
    dir_pin: GPIO3
    max_speed: 300 steps/s
    sleep_pin: GPIO14
    acceleration: 2000.0
    deceleration: 2000.0

# Text sensor for location
text_sensor:
  - platform: template
    name: "${friendly_name} Location"
    id: damper_location
    icon: mdi:map-marker
    update_interval: never
    lambda: |-
      return {"${location}"};

  - platform: template
    name: "${friendly_name} Version"
    id: damper_version
    icon: mdi:tag
    update_interval: never
    lambda: |-
      return {"${version}"};